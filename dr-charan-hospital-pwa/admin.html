<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Supervisor ‚Äì Dr. Charan Hospital</title>
  <link rel="manifest" href="manifest.webmanifest"/>
  <link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css?v=18"/>
</head>
<body>
  <header class="banner">
    <button id="themeToggle" class="chip floating-toggle" aria-label="Theme">üåô</button>
  </header>

  <nav class="fixed-actions">
    <a class="chip" href="login.html">‚Üê Login</a>
    <button id="logoutBtn" class="chip">Logout</button>
    <button id="clearCacheBtn" class="chip">Clear Cache</button>
  </nav>

  <section class="section">
    <div class="card-grid menu">
      <a class="card menu card--blue" href="bookings.html">
        <h2>Bookings</h2>
        <p>Create tokens & manage appointments</p>
      </a>
      <a class="card menu card--mint" href="pharmacy.html">
        <h2>Pharmacy ‚Äì Billing</h2>
        <p>Multi-item invoices, discounts, payments</p>
      </a>
      <a class="card menu card--peach" href="pharmacy-report.html">
        <h2>Pharmacy ‚Äì Reports</h2>
        <p>Daily/Weekly/Monthly/Yearly sales & items</p>
      </a>
    </div>
  </section>

  <script type="module">
    // theme toggle
    const toggle=document.getElementById('themeToggle');
    if(localStorage.theme){ document.documentElement.dataset.theme=localStorage.theme; toggle.textContent=localStorage.theme==='light'?'üåû':'üåô'; }
    toggle.onclick=()=>{ const cur=document.documentElement.dataset.theme||'light'; const next=cur==='light'?'dark':'light'; document.documentElement.dataset.theme=next; localStorage.theme=next; toggle.textContent=next==='light'?'üåû':'üåô'; };

    // session guard (supervisor only)
    const ses=JSON.parse(localStorage.getItem('session')||'{}');
    if(ses.role!=='supervisor'){ location.href='login.html'; }

    // logout & cache
    document.getElementById('logoutBtn').onclick=()=>{ localStorage.removeItem('session'); location.href='login.html'; };
    document.getElementById('clearCacheBtn').onclick=async()=>{
      try{
        localStorage.clear();
        if('caches' in window){ const ks=await caches.keys(); await Promise.all(ks.map(k=>caches.delete(k))); }
        if('serviceWorker' in navigator){ const regs=await navigator.serviceWorker.getRegistrations(); for(const r of regs) await r.unregister(); }
        alert('Cache cleared. Reloading‚Ä¶'); location.reload();
      }catch(e){ alert('Could not fully clear cache.'); }
    };
  </script>
</body>
</html>
