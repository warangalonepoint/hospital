<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Dashboard â€“ Dr. Charan Hospital</title>
  <link rel="manifest" href="manifest.webmanifest"/><link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css?v=7"/>
</head>
<body>
  <!-- Clean banner with small logo -->
  <header class="banner clean">
    <img class="logo-badge" src="assets/logo.png" alt="Dr. Charan Hospital logo" />
  </header>
  <!-- Floating dark/light toggle -->
  <button id="themeToggle" class="chip floating-toggle">ðŸŒ™</button>

  <main class="container">
    <section class="card" id="tabs">
      <div class="grid3">
        <button class="btn" data-tab="pharma">Pharmacy</button>
        <button class="btn" data-tab="invoices">Invoices</button>
        <button class="btn" data-tab="analytics">Analytics</button>
      </div>
      <div class="grid3" style="margin-top:10px">
        <button class="btn" data-tab="patients">Patients</button>
        <button class="btn" data-tab="staff">Staff HR</button>
        <button class="btn" data-tab="upload">Data Upload</button>
      </div>
      <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
        <span id="who" class="chip"></span>
        <button id="logout" class="chip">Logout</button>
        <a class="chip" href="admin.html?v=7">Open Admin</a>
        <a class="chip" href="patient.html?v=7">Patient Booking</a>
        <button id="clearCacheBtn" class="chip" style="margin-left:auto">Clear Cache</button>
      </div>
    </section>

    <!-- Pharma -->
    <section class="card" data-panel="pharma">
      <h3>Daily Pharma Sales</h3>
      <form class="grid3" id="saleForm">
        <div class="field"><label>Date</label><input type="date" name="date"/></div>
        <div class="field"><label>Item</label><input name="item" placeholder="Paracetamol 650"/></div>
        <div class="field"><label>Invoice #</label><input name="invoice" placeholder="INV-001"/></div>
        <div class="field"><label>Qty</label><input name="qty" type="number" min="1" value="1"/></div>
        <div class="field"><label>Price (â‚¹)</label><input name="price" type="number" step="0.01"/></div>
        <div class="field"><label>&nbsp;</label><button class="btn" type="submit">Add</button></div>
      </form>
      <div style="display:flex;justify-content:flex-end;margin-top:8px">
        <button id="exportSales" class="btn ghost">Export Sales CSV</button>
      </div>
      <div class="table-wrap"><table class="table" id="salesTbl"><thead><tr><th>Date</th><th>Item</th><th>Qty</th><th>Price</th><th>Amount</th><th>Invoice</th></tr></thead><tbody></tbody></table></div>
    </section>

    <!-- Invoices -->
    <section class="card" data-panel="invoices" hidden>
      <h3>Invoices</h3>
      <div id="invoiceList"></div>
    </section>

    <!-- Analytics -->
    <section class="card" data-panel="analytics" hidden>
      <h3>Pharma Analytics</h3>
      <div class="grid3">
        <div class="stat"><div class="num" id="totalToday">0</div><div class="lbl">Today â‚¹</div></div>
        <div class="stat"><div class="num" id="totalMonth">0</div><div class="lbl">This Month â‚¹</div></div>
        <div class="stat"><div class="num" id="topItem">â€“</div><div class="lbl">Top Item</div></div>
      </div>
      <canvas id="chart" height="160" style="margin-top:16px;width:100%"></canvas>
    </section>

    <!-- Patients -->
    <section class="card" data-panel="patients" hidden>
      <h3>Patients Panel</h3>
      <form id="patForm" class="grid3">
        <div class="field"><label>Name</label><input name="name"/></div>
        <div class="field"><label>Contact</label><input name="contact" inputmode="tel" placeholder="10-digit"/></div>
        <div class="field"><label>Diagnosis</label><input name="dx" placeholder="e.g. Fever"/></div>
        <div class="field"><label>Date</label><input type="date" name="date"/></div>
        <div class="field"><label>Slot</label><input name="slot" placeholder="10:15 AM"/></div>
        <div class="field"><label>&nbsp;</label><button class="btn" type="submit">Add</button></div>
      </form>
      <div class="table-wrap"><table class="table" id="patTbl"><thead><tr><th>Date</th><th>Time</th><th>Name</th><th>Dx</th><th>WhatsApp</th><th>Reminder</th></tr></thead><tbody></tbody></table></div>
    </section>

    <!-- Staff -->
    <section class="card" data-panel="staff" hidden>
      <h3>Staff Roster</h3>
      <form id="staffForm" class="grid3">
        <div class="field"><label>Date</label><input type="date" name="date"/></div>
        <div class="field"><label>Staff</label><input name="name" placeholder="Nurse A"/></div>
        <div class="field"><label>Shift</label><select name="shift"><option>Morning</option><option>Evening</option><option>Night</option></select></div>
        <div class="field"><label>Status</label><select name="status"><option>Scheduled</option><option>Present</option><option>Absent</option></select></div>
        <div class="field"><label>&nbsp;</label><button class="btn" type="submit">Add</button></div>
      </form>
      <div class="table-wrap"><table class="table" id="staffTbl"><thead><tr><th>Date</th><th>Name</th><th>Shift</th><th>Status</th></tr></thead><tbody></tbody></table></div>
    </section>

    <!-- Upload -->
    <section class="card" data-panel="upload" hidden>
      <h3>Bulk Upload â€“ 5 Years Pharma Data</h3>
      <p class="subtitle">CSV columns: <code>date,item,qty,price,invoice</code></p>
      <input type="file" id="csv" accept=".csv"/>
      <div class="grid2" style="margin-top:10px">
        <button class="btn" id="downloadTemplate">Download Template</button>
        <button class="btn ghost" id="wipe">Wipe All Demo Data</button>
      </div>
    </section>
  </main>

  <footer class="footer">Role-based demo â€¢ Doctor has full access</footer>

  <!-- App logic -->
  <script type="module" src="js/app.js?v=5"></script>

  <!-- Theme toggle + Clear Cache (page-local) -->
  <script>
    // Theme toggle
    const tbtn=document.getElementById('themeToggle');
    if(localStorage.theme){
      document.documentElement.setAttribute('data-theme', localStorage.theme);
      tbtn.textContent = localStorage.theme==='light'?'ðŸŒž':'ðŸŒ™';
    }
    tbtn.onclick=()=>{ const cur=document.documentElement.getAttribute('data-theme'); const next=cur==='light'?'dark':'light'; document.documentElement.setAttribute('data-theme',next); localStorage.theme=next; tbtn.textContent=next==='light'?'ðŸŒž':'ðŸŒ™'; };

    // Clear Cache button
    document.getElementById('clearCacheBtn')?.addEventListener('click', async () => {
      try {
        localStorage.clear();
        if ('caches' in window) {
          const keys = await caches.keys();
          await Promise.all(keys.map(k => caches.delete(k)));
        }
        if ('serviceWorker' in navigator) {
          const regs = await navigator.serviceWorker.getRegistrations();
          for (const r of regs) await r.unregister();
        }
        alert('Cache cleared. Reloadingâ€¦');
        location.reload(true);
      } catch (e) {
        console.error(e); alert('Could not clear everything. Hard reload if needed.');
      }
    });
  </script>
</body>
</html>
