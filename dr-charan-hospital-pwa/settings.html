<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Settings ‚Äì Dr. Charan Hospital</title>
  <link rel="manifest" href="manifest.webmanifest"/>
  <link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css?v=33"/>
</head>
<body>
  <!-- Banner -->
  <header class="banner">
    <button id="themeToggle" class="floating-toggle" aria-label="Theme">üåô</button>
  </header>

  <!-- Fixed actions -->
  <div class="fixed-actions">
    <a href="dashboard.html" class="chip">‚Üê Dashboard</a>
    <button class="chip" id="logoutBtn">Logout</button>
    <button class="chip" id="clearCacheBtn">Clear Cache</button>
  </div>

  <main class="container section">
    <!-- Tabs -->
    <section class="section card panel--lilac">
      <h2>Settings</h2>
      <div class="chips">
        <button class="chip chip--blue">PINs</button>
        <button class="chip chip--mint" onclick="location.href='staff.html'">Staff</button>
        <button class="chip chip--peach" onclick="location.href='patients.html'">Patients</button>
      </div>
    </section>

    <!-- Login PINs -->
    <section class="section card panel--blue" style="margin-top:16px">
      <h3>Login PINs</h3>

      <div class="card panel--lilac" style="margin-top:12px">
        <h4>Doctor</h4>
        <input id="doctorPIN" type="text" placeholder="Enter Doctor PIN"/>
      </div>

      <div class="card panel--mint" style="margin-top:12px">
        <h4>Supervisor</h4>
        <input id="supervisorPIN" type="text" placeholder="Enter Supervisor PIN"/>
      </div>
    </section>
  </main>

  <script>
    // === Theme toggle
    const t=document.getElementById('themeToggle');
    if(localStorage.theme){
      document.documentElement.dataset.theme=localStorage.theme;
      t.textContent=localStorage.theme==='light'?'üåû':'üåô';
    }
    t.onclick=()=>{
      const cur=document.documentElement.dataset.theme||'light';
      const next=cur==='light'?'dark':'light';
      document.documentElement.dataset.theme=next;
      localStorage.theme=next;
      t.textContent=next==='light'?'üåû':'üåô';
    };

    // === Guard
    (()=>{ const s=JSON.parse(localStorage.getItem('session')||'null'); if(!s || s.role!=='doctor') location.replace('login.html'); })();

    // === Actions
    logoutBtn.onclick=()=>{ localStorage.removeItem('session'); location.href='login.html'; };
    clearCacheBtn.onclick=async()=>{
      const keep=localStorage.getItem('session');
      localStorage.clear(); if(keep) localStorage.setItem('session',keep);
      if('caches' in window){ const ks=await caches.keys(); await Promise.all(ks.map(k=>caches.delete(k))); }
      alert('Cache cleared.'); location.reload();
    };

    // === Load & Save
    function loadPINs(){
      try{ return JSON.parse(localStorage.getItem('pins')||'{}'); }catch{return{}}
    }
    function savePINs(obj){
      localStorage.setItem('pins', JSON.stringify(obj));
    }

    function paint(){
      const p=loadPINs();

      // auto-remove patient pin if still present
      if(p.patient){
        delete p.patient;
        savePINs(p);
      }

      document.getElementById('doctorPIN').value=p.doctor||'';
      document.getElementById('supervisorPIN').value=p.supervisor||'';
    }

    document.getElementById('doctorPIN').addEventListener('change',e=>{
      const p=loadPINs(); p.doctor=e.target.value.trim(); savePINs(p);
    });
    document.getElementById('supervisorPIN').addEventListener('change',e=>{
      const p=loadPINs(); p.supervisor=e.target.value.trim(); savePINs(p);
    });

    paint();
  </script>
</body>
</html>
