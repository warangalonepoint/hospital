<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Settings â€“ Dr. Charan</title>
  <link rel="stylesheet" href="styles.css?v=20"/>
</head>
<body>
  <header class="banner">
    <button id="themeToggle" class="chip floating-toggle small">ðŸŒ™</button>
  </header>

  <main class="container">
    <section class="card">
      <h3 class="section-title">Settings</h3>
      <p class="muted">Only Doctor can edit PINs, Staff, and Patients.</p>

      <!-- PINs -->
      <div class="card" style="margin-top:12px">
        <h4 style="margin:0 0 10px">Edit PINs</h4>
        <div class="grid-2">
          <input id="pDoc" class="input" placeholder="Doctor PIN"/>
          <input id="pSup" class="input" placeholder="Supervisor PIN"/>
          <input id="pPat" class="input" placeholder="Patient PIN"/>
        </div>
        <div style="margin-top:10px"><button id="savePins" class="btn">Save PINs</button></div>
      </div>

      <!-- Staff -->
      <div class="card" style="margin-top:16px">
        <h4 style="margin:0 0 10px">Staff</h4>
        <div class="grid-2">
          <input id="sName" class="input" placeholder="Name"/>
          <input id="sPhone" class="input" placeholder="Phone"/>
        </div>
        <div style="margin-top:10px"><button id="addStaff" class="btn">Add Staff</button></div>
        <div id="staffList" style="margin-top:10px"></div>
      </div>

      <!-- Patients -->
      <div class="card" style="margin-top:16px">
        <h4 style="margin:0 0 10px">Patients</h4>
        <div class="grid-2">
          <input id="ptName" class="input" placeholder="Name"/>
          <input id="ptPhone" class="input" placeholder="Phone"/>
        </div>
        <input id="ptNotes" class="input" style="margin-top:10px" placeholder="Notes / treatment / reminders"/>
        <div style="margin-top:10px"><button id="addPatient" class="btn">Add Patient</button></div>
        <div id="patientList" style="margin-top:10px"></div>
      </div>
    </section>
  </main>

  <script type="module">
    import { role, getPins, setPin, listStaff, addStaff, listPatients, addPatient } from './js/store.js?v=21';

    const t=document.getElementById('themeToggle');
    if(localStorage.theme){ document.documentElement.dataset.theme=localStorage.theme; t.textContent=localStorage.theme==='light'?'ðŸŒž':'ðŸŒ™'; }
    t.onclick=()=>{ const cur=document.documentElement.dataset.theme||'light'; const next=cur==='light'?'dark':'light'; document.documentElement.dataset.theme=next; localStorage.theme=next; t.textContent=next==='light'?'ðŸŒž':'ðŸŒ™'; };

    const canEdit = role()==='doctor';
    document.querySelectorAll('input, button').forEach(el=>{
      if(el.id && (el.id.startsWith('p')||el.id.startsWith('s')||el.id.startsWith('pt')||el.id.startsWith('add')||el.id==='savePins')){
        if(!canEdit) el.disabled=true;
      }
    });

    const pins=getPins(); pDoc.value=pins.doctor; pSup.value=pins.supervisor; pPat.value=pins.patient;

    function renderStaff(){ staffList.innerHTML = listStaff().map(s=>`<div class="stat"><div class="k" style="font-size:18px">${s.name}</div><div class="muted">${s.phone} â€¢ ${s.role||''}</div></div>`).join(''); }
    function renderPatients(){ patientList.innerHTML = listPatients().map(p=>`<div class="stat"><div class="k" style="font-size:18px">${p.name}</div><div class="muted">${p.phone} â€¢ ${p.notes||'â€”'}</div></div>`).join(''); }

    savePins.onclick=()=>{ if(!canEdit) return; setPin('doctor', pDoc.value); setPin('supervisor', pSup.value); setPin('patient', pPat.value); alert('PINs updated'); };
    addStaff.onclick=()=>{ if(!canEdit) return; if(!sName.value) return alert('Name?'); addStaff({name:sName.value, phone:sPhone.value, role:'staff'}); sName.value=sPhone.value=''; renderStaff(); };
    addPatient.onclick=()=>{ if(!canEdit) return; if(!ptName.value) return alert('Name?'); addPatient({name:ptName.value, phone:ptPhone.value, notes:ptNotes.value}); ptName.value=ptPhone.value=ptNotes.value=''; renderPatients(); };

    renderStaff(); renderPatients();
  </script>
</body>
</html>

