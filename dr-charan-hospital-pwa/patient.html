<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Patient Booking â€“ Dr. Charan Hospital</title>
  <link rel="manifest" href="manifest.webmanifest"/><link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css?v=5"/>
</head>
<body>
  <header class="banner">
    <div class="brand">
      <img src="assets/logo.png" alt="Logo">
      <div>
        <h1 class="title">Dr. Charan Hospital</h1>
        <p class="subtitle">Patient Booking</p>
      </div>
    </div>
    <button id="themeToggle" class="chip">ðŸŒ™</button>
  </header>

  <main class="container narrow">
    <form id="bookingForm" class="card">
      <div class="field"><label>Patient Name</label><input required name="name" placeholder="Full name"/></div>
      <div class="field"><label>Contact (WhatsApp)</label><input required name="contact" inputmode="tel" placeholder="10-digit" pattern="[0-9]{10}"/></div>
      <div class="field"><label>Reason</label><select name="reason"><option>Consultation</option><option>Follow-up</option><option>Diagnostics</option></select></div>
      <div class="field"><label>Date</label><input required name="date" type="date"/></div>
      <div class="field"><label>Time Slot</label><select name="slot" id="slotSelect"></select></div>
      <button class="btn" type="submit">Book Slot</button>
    </form>

    <section class="card" id="confirm" hidden>
      <h3>Booking Confirmed âœ…</h3>
      <p id="confirmText"></p>
      <div class="grid2"><a class="btn" id="waBtn" target="_blank">Send WhatsApp</a><a class="btn ghost" href="admin.html?v=5">Go to Admin</a></div>
    </section>
  </main>

  <footer class="footer">Demo only â€¢ Data saved locally</footer>

  <script type="module">
    // theme
    const tbtn=document.getElementById('themeToggle');
    if(localStorage.theme){ document.documentElement.setAttribute('data-theme', localStorage.theme); tbtn.textContent = localStorage.theme==='light'?'ðŸŒž':'ðŸŒ™'; }
    tbtn.onclick=()=>{ const cur=document.documentElement.getAttribute('data-theme'); const next=cur==='light'?'dark':'light'; document.documentElement.setAttribute('data-theme',next); localStorage.theme=next; tbtn.textContent=next==='light'?'ðŸŒž':'ðŸŒ™'; };

    import { initSlotsForDate, getAvailableSlots, saveBooking, nextTokenForDate } from './js/store.js?v=5';
    const form=document.getElementById('bookingForm'), slotSelect=document.getElementById('slotSelect');
    const confirm=document.getElementById('confirm'), confirmText=document.getElementById('confirmText'), waBtn=document.getElementById('waBtn');

    form.date.valueAsDate=new Date();
    const renderSlots=()=>{ const d=form.date.value; initSlotsForDate(d); slotSelect.innerHTML=''; for(const s of getAvailableSlots(d)){ const o=document.createElement('option'); o.value=s; o.textContent=s; slotSelect.appendChild(o); } };
    renderSlots(); form.date.addEventListener('change',renderSlots);

    form.addEventListener('submit',(e)=>{
      e.preventDefault();
      const data=Object.fromEntries(new FormData(form)); const token=nextTokenForDate(data.date);
      const rec=saveBooking({ name:data.name.trim(), contact:data.contact.trim(), reason:data.reason, date:data.date, slot:data.slot, token });
      form.hidden=true; confirm.hidden=false; confirmText.textContent=`Token ${rec.token} for ${rec.name} on ${rec.date} at ${rec.slot}.`;
      const msg=encodeURIComponent(`Hi ${rec.name}, your appointment is confirmed. Date: ${rec.date}, Time: ${rec.slot}, Token: ${rec.token}. â€“ Dr. Charan Hospital`);
      waBtn.href=`https://wa.me/91${rec.contact}?text=${msg}`;
    });
  </script>
</body>
</html>
