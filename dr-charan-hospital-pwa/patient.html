<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Bookings â€“ Dr. Charan</title>
  <link rel="stylesheet" href="styles.css?v=20"/>
</head>
<body>
  <header class="banner">
    <button id="themeToggle" class="chip floating-toggle small">ðŸŒ™</button>
  </header>

  <main class="container">
    <section class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap">
        <h3 class="section-title">Patient Bookings</h3>
        <span class="chip small" id="roleHint"></span>
      </div>

      <div id="formWrap" class="card" style="margin-top:12px">
        <div class="grid-2">
          <input id="bDate" class="input" type="date"/>
          <input id="bTime" class="input" type="time"/>
          <input id="bName" class="input" placeholder="Patient name"/>
          <input id="bReason" class="input" placeholder="Reason"/>
        </div>
        <div style="margin-top:10px"><button id="addBooking" class="btn">Add Booking</button></div>
        <p class="muted" style="margin-top:6px">Only Supervisor can add. Doctor view is read-only.</p>
      </div>

      <div class="chart-card">
        <h4 style="margin:0 0 8px">Upcoming</h4>
        <div id="list"></div>
      </div>
    </section>
  </main>

  <script type="module">
    import { role, listBookings, addBooking } from './js/store.js?v=21';

    const t=document.getElementById('themeToggle');
    if(localStorage.theme){ document.documentElement.dataset.theme=localStorage.theme; t.textContent=localStorage.theme==='light'?'ðŸŒž':'ðŸŒ™'; }
    t.onclick=()=>{ const cur=document.documentElement.dataset.theme||'light'; const next=cur==='light'?'dark':'light'; document.documentElement.dataset.theme=next; localStorage.theme=next; t.textContent=next==='light'?'ðŸŒž':'ðŸŒ™'; };

    const r=role(); document.getElementById('roleHint').textContent = `Role: ${r||'guest'}`;
    if(r!=='supervisor'){ document.getElementById('formWrap').style.display='none'; }

    function render(){
      const wrap=document.getElementById('list'); wrap.innerHTML='';
      const data=listBookings().sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time));
      data.forEach(b=>{
        const row=document.createElement('div');
        row.className='stat';
        row.innerHTML=`<div class="k" style="font-size:18px">${b.patient}</div>
                       <div class="muted">${b.date} â€¢ ${b.time} â€¢ ${b.reason}</div>`;
        wrap.appendChild(row);
      });
    }

    document.getElementById('addBooking')?.addEventListener('click', ()=>{
      const b={ date:bDate.value, time:bTime.value, patient:bName.value, reason:bReason.value };
      if(!b.date || !b.time || !b.patient){ alert('Fill date/time/name'); return; }
      addBooking(b); bDate.value=bTime.value=bName.value=bReason.value='';
      render();
    });

    render();
  </script>
</body>
</html>
