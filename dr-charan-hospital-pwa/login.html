<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Login â€“ Dr. Charan Hospital</title>
  <link rel="manifest" href="manifest.webmanifest"/>
  <link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css?v=14"/>
</head>
<body>
  <!-- Banner already includes logo + title -->
  <header class="banner clean"></header>
  <button id="themeToggle" class="chip floating-toggle">ðŸŒ™</button>

  <main class="container n8">
    <section class="card">
      <h3 style="margin-top:0">PIN Login</h3>
      <div class="form-grid">
        <div class="field">
          <label>Enter PIN</label>
          <input id="pin" type="password" inputmode="numeric" maxlength="6" placeholder="4â€“6 digits"/>
        </div>
        <div class="field" style="align-items:end">
          <button id="loginBtn" class="btn">Login</button>
        </div>
      </div>
      <div id="err" style="color:var(--danger);margin-top:8px"></div>
    </section>
  </main>

  <footer style="text-align:center;color:var(--muted);margin:20px 0 40px">
    Demo PINs â†’ Doctor: 4321 â€¢ Supervisor: 1111 â€¢ Patient: 2222
  </footer>

  <script type="module">
    import { authenticatePin } from './js/store.js?v=14';

    // Theme toggle
    const tbtn=document.getElementById('themeToggle');
    if(localStorage.theme){
      document.documentElement.setAttribute('data-theme', localStorage.theme);
      tbtn.textContent = localStorage.theme==='light'?'ðŸŒž':'ðŸŒ™';
    }
    tbtn.onclick=()=>{
      const cur=document.documentElement.getAttribute('data-theme')||'light';
      const next=cur==='light'?'dark':'light';
      document.documentElement.setAttribute('data-theme',next);
      localStorage.theme=next;
      tbtn.textContent=next==='light'?'ðŸŒž':'ðŸŒ™';
    };

    // Login handler
    document.getElementById('loginBtn').onclick=async()=>{
      const pin=document.getElementById('pin').value.trim();
      const err=document.getElementById('err');
      err.textContent='';
      if(!pin){ err.textContent='Enter your PIN'; return; }
      const user=await authenticatePin(pin);
      if(!user){ err.textContent='Invalid PIN'; return; }
      if(user.role==='doctor'){ location.href='dashboard.html?v=15'; }
      else if(user.role==='supervisor'){ location.href='admin.html?v=15'; }
      else if(user.role==='patient'){ location.href='portal.html?v=15'; }
      else{ err.textContent='Unknown role'; }
    };

    // Allow pressing Enter
    document.getElementById('pin').addEventListener('keyup',e=>{
      if(e.key==='Enter') document.getElementById('loginBtn').click();
    });
  </script>
</body>
</html>
