<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Login â€“ Dr. Charan Hospital</title>
  <link rel="manifest" href="manifest.webmanifest"/>
  <link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css?v=14"/>
</head>
<body>
  <header class="banner clean"></header>
  <button id="themeToggle" class="chip floating-toggle">ðŸŒ™</button>

  <main class="container n8">
    <section class="card">
      <h3 style="margin-top:0">PIN Login</h3>
      <div class="form-grid">
        <div class="field">
          <label>Enter PIN</label>
          <input id="pin" type="password" inputmode="numeric" maxlength="6" placeholder="4â€“6 digits"/>
        </div>
        <div class="field" style="align-items:end">
          <button id="loginBtn" class="btn">Login</button>
        </div>
      </div>
      <div id="err" style="color:#d33;margin-top:8px"></div>
      <div class="muted" style="margin-top:10px">Demo: 4321 (Doctor) Â· 1111 (Supervisor) Â· 2222 (Patient)</div>
    </section>
  </main>

  <script type="module">
    import { authenticatePin, currentUser } from './js/store.js?v=21';

    // skip if already logged in
    const u=currentUser(); 
    if(u){ route(u.role); }

    function route(role){
      if(role==='doctor') location.href='dashboard.html';
      else if(role==='supervisor') location.href='admin.html';
      else location.href='portal.html';
    }

    document.getElementById('loginBtn').onclick=()=>{
      const pin=document.getElementById('pin').value.trim();
      const err=document.getElementById('err'); err.textContent='';
      if(!pin){ err.textContent='Enter your PIN'; return; }
      const user=authenticatePin(pin);
      if(!user){ err.textContent='Invalid PIN'; return; }
      route(user.role);
    };
    document.getElementById('pin').addEventListener('keyup',e=>{
      if(e.key==='Enter') document.getElementById('loginBtn').click();
    });

    // theme toggle
    const t=document.getElementById('themeToggle');
    if(localStorage.theme){ document.documentElement.dataset.theme=localStorage.theme; t.textContent=localStorage.theme==='light'?'ðŸŒž':'ðŸŒ™'; }
    t.onclick=()=>{ const cur=document.documentElement.dataset.theme||'light'; const next=cur==='light'?'dark':'light'; document.documentElement.dataset.theme=next; localStorage.theme=next; t.textContent=next==='light'?'ðŸŒž':'ðŸŒ™'; };
  </script>

  <!-- SW registration (optional but recommended) -->
  <script>
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('service-worker.js').catch(()=>{}); }
  </script>
</body>
</html>
